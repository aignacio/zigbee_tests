###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.30.1.41636 for 8051             31/Jul/2014  22:00:50 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\ParkWay\Source\PW_EndDevice.c      #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\ParkWay\CC2530DB\..\..\..\Tool #
#                          s\CC2530DB\f8wEndev.cfg" (-DCPU32MHZ               #
#                          -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3         #
#                          -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3) -f          #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\ParkWay\CC2530DB\..\..\..\Tools\C #
#                          C2530DB\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0     #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\Source\PW_EndDevice.c" -D           #
#                          NWK_AUTO_POLL -D ZTOOL_P1 -D MT_TASK -D            #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D                      #
#                          xLCD_SUPPORTED=DEBUG -D xPOWER_SAVING -lC          #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\ParkWay\CC2530DB\EndDeviceEB\List #
#                          \" -lA "C:\Texas Instruments\ZStack-CC2530-2.5.1a\ #
#                          Projects\zstack\Samples\ParkWay\CC2530DB\EndDevice #
#                          EB\List\" --diag_suppress Pe001,Pa010 -o           #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\ParkWay\CC2530DB\EndDeviceEB\Obj\ #
#                          " -e --no_code_motion --debug --core=plain         #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 8 -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\Source\" -I "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\ZMain\TI2530DB\"  #
#                          -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\ParkWay\CC2530DB\..\..\..\..\. #
#                          .\Components\hal\include\" -I "C:\Texas            #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          hal\target\CC2530EB\" -I "C:\Texas                 #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          mac\include\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          mac\high_level\" -I "C:\Texas                      #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          mac\low_level\srf04\" -I "C:\Texas                 #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          mac\low_level\srf04\single_chip\" -I "C:\Texas     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          mt\" -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a #
#                          \Projects\zstack\Samples\ParkWay\CC2530DB\..\..\.. #
#                          \..\..\Components\osal\include\" -I "C:\Texas      #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          services\saddr\" -I "C:\Texas                      #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          services\sdata\" -I "C:\Texas                      #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\af\" -I "C:\Texas Instruments\ZStack-CC2530- #
#                          2.5.1a\Projects\zstack\Samples\ParkWay\CC2530DB\.. #
#                          \..\..\..\..\Components\stack\nwk\" -I "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\sapi\" -I "C:\Texas                          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\sec\" -I "C:\Texas                           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\sys\" -I "C:\Texas                           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\zdo\" -I "C:\Texas                           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\ParkWay\CC2530DB\..\..\..\..\..\Components\ #
#                          zmac\" -I "C:\Texas Instruments\ZStack-CC2530-2.5. #
#                          1a\Projects\zstack\Samples\ParkWay\CC2530DB\..\..\ #
#                          ..\..\..\Components\zmac\f8w\" -Ohz                #
#                          --require_prototypes                               #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\ParkWay\CC2530DB\EndDeviceEB\List\ #
#                          PW_EndDevice.lst                                   #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\ParkWay\CC2530DB\EndDeviceEB\Obj\P #
#                          W_EndDevice.r51                                    #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ParkWay\Source\PW_EndDevice.c
      1          /*****************************************************************************
      2            Project: Park Way (ZigBee)
      3            End Device Firmware
      4          
      5            Ver.: 1.0
      6            Date: 31/07/14
      7            Developer:  Ânderson Ignácio da Silva
      8            Obs.:
      9              -LCD_SUPPORTED=DEBUG or LCD_SUPPORTED must be disable in the CC2530 China 
     10              modules to work
     11              
     12              -BEFORE PROGRAMMING is important to ERASE the FLASH memory with the FLASH
     13              programmer because the NV_RESTORE option is enabled  to restore the  End 
     14              Devices after the coordinator power down
     15          
     16              -When the board has PA_LNA RANGE EXTENDER, it must be necessary to cut off
     17              the 'x' from the defines of #define xHAL_PA_LNA of the hal_board_cfg.h
     18          
     19            Pre-processor directives:
     20              NWK_AUTO_POLL
     21              ZTOOL_P1
     22              MT_TASK
     23              MT_SYS_FUNC
     24              MT_ZDO_FUNC
     25              xLCD_SUPPORTED=DEBUG
     26              xPOWER_SAVING
     27          
     28          *****************************************************************************/
     29          
     30          /*********************************************************************
     31           * INCLUDES
     32           */
     33          #include "OSAL.h"
     34          #include "AF.h"
     35          #include "ZDApp.h"
     36          #include "ZDObject.h"
     37          #include "ZDProfile.h"
     38          #include "ParkWay.h"
     39          #include "DebugTrace.h"
     40          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x80
   \   union <unnamed> volatile __sfr _A_P0
   \                     _A_P0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf3
   \   unsigned char volatile __sfr P0SEL
   \                     P0SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfd
   \   unsigned char volatile __sfr P0DIR
   \                     P0DIR:
   \   000000                DS 1
     41          /* HAL */
     42          #include "hal_lcd.h"
     43          #include "hal_led.h"
     44          #include "hal_key.h"
     45          #include "hal_uart.h"
     46          
     47          /*********************************************************************
     48           * MACROS
     49           */
     50          
     51          /*********************************************************************
     52           * CONSTANTS
     53           */
     54          #define   DEVICE_PW_1                  '0'     //(first char)Tag of the device 
     55          #define   DEVICE_PW_2                  '6'     //(second char)Tag of the device
     56          #define   ParkWay_SEND_MSG_TIMEOUT     800     //Time to send data to the coordinator(poll ultrasound-ms)
     57          #define   TIME_TO_CONNECT_COORD       1000     //Time to connect (auto bind) the device to the coord(ms).
     58          #define   PIN_TRIGGER                 0x02     //Ultrasonic pin trigger - P0.1
     59          #define   PIN_ECHO                    0x04     //Ultrasonic pin trigger - P0.2
     60          #define   DISTANCE_CONSTANT          10000     //Distance measured by the ultrasonic
     61          #define   PIN_GREEN_LED               0x08     //P0.3
     62          #define   PIN_RED_LED                 0x10     //P0.4
     63          #define   TIME_ULTRA                   200     //Poll time to read ultrasonic
     64          /*********************************************************************
     65           * TYPEDEFS
     66           */
     67          
     68          /*********************************************************************
     69           * GLOBAL VARIABLES
     70           */
     71          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
     72          const cId_t ParkWay_ClusterList[ParkWay_MAX_CLUSTERS] =
   \                     ParkWay_ClusterList:
   \   000000   0100         DW 1
     73          {
     74            ParkWay_CLUSTERID
     75          };
     76          

   \                                 In  segment XDATA_ROM_C, align 1
     77          const SimpleDescriptionFormat_t ParkWay_SimpleDesc =
   \                     ParkWay_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F         DW 3844
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   01           DB 1
   \   000007   ....         DW ParkWay_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW ParkWay_ClusterList
     78          {
     79            ParkWay_ENDPOINT,              //  int Endpoint;
     80            ParkWay_PROFID,                //  uint16 AppProfId[2];
     81            ParkWay_DEVICEID,              //  uint16 AppDeviceId[2];
     82            ParkWay_DEVICE_VERSION,        //  int   AppDevVer:4;
     83            ParkWay_FLAGS,                 //  int   AppFlags:4;
     84            ParkWay_MAX_CLUSTERS,          //  byte  AppNumInClusters;
     85            (cId_t *)ParkWay_ClusterList,  //  byte *pAppInClusterList;
     86            ParkWay_MAX_CLUSTERS,          //  byte  AppNumInClusters;
     87            (cId_t *)ParkWay_ClusterList   //  byte *pAppInClusterList;
     88          };
     89          

   \                                 In  segment XDATA_I, align 1, keep-with-next
     90          uint8 vaga='0';
   \                     vaga:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for vaga>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
     91          uint8 fifo_ultra[12]={"000000000000"};
   \                     fifo_ultra:
   \   000000                DS 12
   \   00000C                REQUIRE `?<Initializer for fifo_ultra>`
   \   00000C                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     92          uint8 index_flag=0;
   \                     index_flag:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     93          
     94          // This is the Endpoint/Interface description.  It is defined here, but
     95          // filled-in in ParkWay_Init().  Another way to go would be to fill
     96          // in the structure here and make it a "const" (in code space).  The
     97          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     98          endPointDesc_t ParkWay_epDesc;
   \                     ParkWay_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
     99          
    100          /*********************************************************************
    101           * EXTERNAL VARIABLES
    102           */
    103          
    104          /*********************************************************************
    105           * EXTERNAL FUNCTIONS
    106           */
    107          
    108          /*********************************************************************
    109           * LOCAL VARIABLES
    110           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    111          byte ParkWay_TaskID;   // Task ID for internal task/event processing
   \                     ParkWay_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    112                                    // This variable will be received when
    113                                    // ParkWay_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    114          devStates_t ParkWay_NwkState;
   \                     ParkWay_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    115          
    116          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    117          byte ParkWay_TransID;  // This is the unique message ID (counter)
   \                     ParkWay_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    118          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    119          afAddrType_t ParkWay_DstAddr;
   \                     ParkWay_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    120          
    121          /*********************************************************************
    122           * LOCAL FUNCTIONS
    123           */
    124          void SendUART(uint8 *data,uint8 len);
    125          void uart_init(void);
    126          static void ParkWay_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    127          static void ParkWay_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    128          static void ParkWay_SendTheMessage( void );
    129          void read_ultrasonic(void);
    130          void control_fifo(uint16 ultra);
    131          /*********************************************************************
    132           * NETWORK LAYER CALLBACKS
    133           */
    134          
    135          /*********************************************************************
    136           * PUBLIC FUNCTIONS
    137           */
    138          
    139          //Initialization function for the Park Way task. This is called during initialization and should contain any application specific initialization (ie. hardware initialization/setup, table initialization, power up notificaiton ... )

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    140          void ParkWay_Init( uint8 task_id )
   \                     ParkWay_Init:
    141          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    142            ParkWay_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#ParkWay_TaskID
   \   000009   F0           MOVX    @DPTR,A
    143            ParkWay_NwkState = DEV_INIT;
   \   00000A   90....       MOV     DPTR,#ParkWay_NwkState
   \   00000D   7401         MOV     A,#0x1
   \   00000F   F0           MOVX    @DPTR,A
    144            ParkWay_TransID = 0;
   \   000010   90....       MOV     DPTR,#ParkWay_TransID
   \   000013   E4           CLR     A
   \   000014   F0           MOVX    @DPTR,A
    145          
    146            // Device hardware initialization can be added here or in main() (Zmain.c).
    147            // If the hardware is application specific - add it here.
    148            // If the hardware is other parts of the device add it in main().
    149          
    150            ParkWay_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
   \   000015   90....       MOV     DPTR,#ParkWay_DstAddr + 8
   \   000018   F0           MOVX    @DPTR,A
    151            ParkWay_DstAddr.endPoint = 0;
   \   000019   A3           INC     DPTR
   \   00001A   F0           MOVX    @DPTR,A
    152            ParkWay_DstAddr.addr.shortAddr = 0;
   \   00001B   90....       MOV     DPTR,#ParkWay_DstAddr
   \   00001E   F0           MOVX    @DPTR,A
   \   00001F   A3           INC     DPTR
   \   000020   F0           MOVX    @DPTR,A
    153          
    154            // Fill out the endpoint description.
    155            ParkWay_epDesc.endPoint = ParkWay_ENDPOINT;
   \   000021   90....       MOV     DPTR,#ParkWay_epDesc
   \   000024   740A         MOV     A,#0xa
   \   000026   F0           MOVX    @DPTR,A
    156            ParkWay_epDesc.task_id = &ParkWay_TaskID;
   \   000027   A3           INC     DPTR
   \   000028   74..         MOV     A,#ParkWay_TaskID & 0xff
   \   00002A   F0           MOVX    @DPTR,A
   \   00002B   A3           INC     DPTR
   \   00002C   74..         MOV     A,#(ParkWay_TaskID >> 8) & 0xff
   \   00002E   F0           MOVX    @DPTR,A
    157            ParkWay_epDesc.simpleDesc
    158                      = (SimpleDescriptionFormat_t *)&ParkWay_SimpleDesc;
   \   00002F   A3           INC     DPTR
   \   000030   74..         MOV     A,#ParkWay_SimpleDesc & 0xff
   \   000032   F0           MOVX    @DPTR,A
   \   000033   A3           INC     DPTR
   \   000034   74..         MOV     A,#(ParkWay_SimpleDesc >> 8) & 0xff
   \   000036   F0           MOVX    @DPTR,A
    159            ParkWay_epDesc.latencyReq = noLatencyReqs;
   \   000037   A3           INC     DPTR
   \   000038   E4           CLR     A
   \   000039   F0           MOVX    @DPTR,A
    160          
    161            // Register the endpoint description with the AF
    162            afRegister( &ParkWay_epDesc );
   \   00003A                ; Setup parameters for call to function afRegister
   \   00003A   7A..         MOV     R2,#ParkWay_epDesc & 0xff
   \   00003C   7B..         MOV     R3,#(ParkWay_epDesc >> 8) & 0xff
   \   00003E   12....       LCALL   ??afRegister?relay   ; Banked call to: afRegister
    163          
    164            // Register for all key events - This app will handle all key events
    165            RegisterForKeys( ParkWay_TaskID );
   \   000041                ; Setup parameters for call to function RegisterForKeys
   \   000041   90....       MOV     DPTR,#ParkWay_TaskID
   \   000044   E0           MOVX    A,@DPTR
   \   000045   F9           MOV     R1,A
   \   000046   12....       LCALL   ??RegisterForKeys?relay; Banked call to: RegisterForKeys
    166          
    167            // Update the display
    168          #if defined ( LCD_SUPPORTED )
    169            HalLcdWriteString( "ParkWay-Peer", HAL_LCD_LINE_1 );
    170          #endif
    171          
    172            ZDO_RegisterForZDOMsg( ParkWay_TaskID, End_Device_Bind_rsp );
   \   000049                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000049   7A20         MOV     R2,#0x20
   \   00004B   7B80         MOV     R3,#-0x80
   \   00004D   90....       MOV     DPTR,#ParkWay_TaskID
   \   000050   E0           MOVX    A,@DPTR
   \   000051   F9           MOV     R1,A
   \   000052   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay; Banked call to: ZDO_RegisterForZDOMsg
    173            ZDO_RegisterForZDOMsg( ParkWay_TaskID, Match_Desc_rsp );
   \   000055                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000055   7A06         MOV     R2,#0x6
   \   000057   7B80         MOV     R3,#-0x80
   \   000059   90....       MOV     DPTR,#ParkWay_TaskID
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   F9           MOV     R1,A
   \   00005E   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay; Banked call to: ZDO_RegisterForZDOMsg
    174          
    175            osal_start_timerEx( ParkWay_TaskID,
    176                                POLLING_OF_DEV_EVT,
    177                                TIME_TO_CONNECT_COORD);
   \   000061                ; Setup parameters for call to function osal_start_timerEx
   \   000061   7CE8         MOV     R4,#-0x18
   \   000063   7D03         MOV     R5,#0x3
   \   000065   7A02         MOV     R2,#0x2
   \   000067   7B00         MOV     R3,#0x0
   \   000069   90....       MOV     DPTR,#ParkWay_TaskID
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   F9           MOV     R1,A
   \   00006E   12....       LCALL   ??osal_start_timerEx?relay; Banked call to: osal_start_timerEx
    178          }
   \   000071                REQUIRE ?Subroutine0
   \   000071                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    179          
    180          //Main function to proccess the timers and events 

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    181          uint16 ParkWay_ProcessEvent( uint8 task_id, uint16 events )
   \                     ParkWay_ProcessEvent:
    182          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 15
   \   000005   74F1         MOV     A,#-0xf
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    183            afIncomingMSGPacket_t *MSGpkt;
    184            //afDataConfirm_t *afDataConfirm;
    185            zAddrType_t dstAddr;
    186          
    187            // Data Confirmation message fields
    188            //byte sentEP;
    189            //ZStatus_t sentStatus;
    190            //byte sentTransID;       // This should match the value sent
    191            (void)task_id;  // Intentionally unreferenced parameter
    192          
    193            if ( events & SYS_EVENT_MSG )
   \   00000E   5480         ANL     A,#0x80
   \   000010   7003         JNZ     $+5
   \   000012   02....       LJMP    ??ParkWay_ProcessEvent_0 & 0xFFFF
    194            {
    195              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( ParkWay_TaskID );
   \   000015                ; Setup parameters for call to function osal_msg_receive
   \   000015   803B         SJMP    ??ParkWay_ProcessEvent_1
    196              while ( MSGpkt )
    197              {
    198                switch ( MSGpkt->hdr.event )
    199                {
    200                  case ZDO_CB_MSG: //Event trigger by ZigBee Device Object like connect, bind...etc
    201                    ParkWay_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    202                    break;
    203          
    204                  case AF_DATA_CONFIRM_CMD: //Event trigger by a confirmation of sent message
    205                    // This message is received as a confirmation of a data packet sent.
    206                    // The status is of ZStatus_t type [defined in ZComDef.h]
    207                    // The message fields are defined in AF.h
    208                    // afDataConfirm = (afDataConfirm_t *)MSGpkt;
    209                    // sentEP = afDataConfirm->endpoint;
    210                    // sentStatus = afDataConfirm->hdr.status;
    211                    // sentTransID = afDataConfirm->transID;
    212                    // (void)sentEP;
    213                    // (void)sentTransID;
    214          
    215                    // // Action taken when confirmation is received.
    216                    // if ( sentStatus != ZSuccess )
    217                    // {
    218                    //   // The data wasn't delivered -- Do something
    219                    // }
    220                    break;
    221          
    222                  case AF_INCOMING_MSG_CMD: //Event trigger by a receive message
    223                    ParkWay_MessageMSGCB( MSGpkt );
    224                    break;
    225          
    226                  case ZDO_STATE_CHANGE: //Event trigger by a connection to the coordinator or Router
    227                    ParkWay_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??ParkWay_ProcessEvent_2:
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   90....       MOV     DPTR,#ParkWay_NwkState
   \   00001C   F0           MOVX    @DPTR,A
    228                    if ( (ParkWay_NwkState == DEV_ZB_COORD)
    229                        || (ParkWay_NwkState == DEV_ROUTER)
    230                        || (ParkWay_NwkState == DEV_END_DEVICE) )
   \   00001D   6409         XRL     A,#0x9
   \   00001F   600A         JZ      ??ParkWay_ProcessEvent_3
   \   000021   E0           MOVX    A,@DPTR
   \   000022   6407         XRL     A,#0x7
   \   000024   6005         JZ      ??ParkWay_ProcessEvent_3
   \   000026   E0           MOVX    A,@DPTR
   \   000027   6406         XRL     A,#0x6
   \   000029   7020         JNZ     ??ParkWay_ProcessEvent_4
    231                    {
    232                      // Start sending the status message in a regular interval.
    233                      osal_start_timerEx( ParkWay_TaskID,
    234                                          ParkWay_SEND_MSG_EVT,
    235                                          ParkWay_SEND_MSG_TIMEOUT );
   \                     ??ParkWay_ProcessEvent_3:
   \   00002B                ; Setup parameters for call to function osal_start_timerEx
   \   00002B   7C20         MOV     R4,#0x20
   \   00002D   7D03         MOV     R5,#0x3
   \   00002F   7A01         MOV     R2,#0x1
   \   000031   7B00         MOV     R3,#0x0
   \   000033   90....       MOV     DPTR,#ParkWay_TaskID
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F9           MOV     R1,A
   \   000038   12....       LCALL   ??osal_start_timerEx?relay; Banked call to: osal_start_timerEx
    236                      // Start reading ultrasonic in a regular interval.
    237                      osal_start_timerEx( ParkWay_TaskID,
    238                                          POLLING_ULTRASONIC,
    239                                          TIME_ULTRA);
   \   00003B                ; Setup parameters for call to function osal_start_timerEx
   \   00003B   7CC8         MOV     R4,#-0x38
   \   00003D   7D00         MOV     R5,#0x0
   \   00003F   7A04         MOV     R2,#0x4
   \   000041   7B00         MOV     R3,#0x0
   \   000043   90....       MOV     DPTR,#ParkWay_TaskID
   \   000046   E0           MOVX    A,@DPTR
   \   000047   F9           MOV     R1,A
   \   000048   12....       LCALL   ??osal_start_timerEx?relay; Banked call to: osal_start_timerEx
    240                    }
    241                    break;
    242          
    243                  default:
    244                    break;
    245                }
    246          
    247                // Release the memory
    248                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??ParkWay_ProcessEvent_4:
   \   00004B                ; Setup parameters for call to function osal_msg_deallocate
   \   00004B   AA..         MOV     R2,?V2
   \   00004D   AB..         MOV     R3,?V3
   \   00004F   12....       LCALL   ??osal_msg_deallocate?relay; Banked call to: osal_msg_deallocate
    249          
    250                // Next
    251                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( ParkWay_TaskID );
   \   000052                ; Setup parameters for call to function osal_msg_receive
   \                     ??ParkWay_ProcessEvent_1:
   \   000052   90....       MOV     DPTR,#ParkWay_TaskID
   \   000055   E0           MOVX    A,@DPTR
   \   000056   F9           MOV     R1,A
   \   000057   12....       LCALL   ??osal_msg_receive?relay; Banked call to: osal_msg_receive
   \   00005A   8A..         MOV     ?V2,R2
   \   00005C   8B..         MOV     ?V3,R3
   \   00005E   E5..         MOV     A,?V2
   \   000060   45..         ORL     A,?V3
   \   000062   607D         JZ      ??ParkWay_ProcessEvent_5
   \   000064   85..82       MOV     DPL,?V2
   \   000067   85..83       MOV     DPH,?V3
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   242F         ADD     A,#0x2f
   \   00006D   60A8         JZ      ??ParkWay_ProcessEvent_2
   \   00006F   24FE         ADD     A,#-0x2
   \   000071   70D8         JNZ     ??ParkWay_ProcessEvent_4
   \   000073   E5..         MOV     A,?V2
   \   000075   240C         ADD     A,#0xc
   \   000077   F582         MOV     DPL,A
   \   000079   E4           CLR     A
   \   00007A   35..         ADDC    A,?V3
   \   00007C   F583         MOV     DPH,A
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   6406         XRL     A,#0x6
   \   000081   7004         JNZ     ??ParkWay_ProcessEvent_6
   \   000083   A3           INC     DPTR
   \   000084   E0           MOVX    A,@DPTR
   \   000085   6480         XRL     A,#0x80
   \                     ??ParkWay_ProcessEvent_6:
   \   000087   70C2         JNZ     ??ParkWay_ProcessEvent_4
   \   000089                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   000089   AA..         MOV     R2,?V2
   \   00008B   AB..         MOV     R3,?V3
   \   00008D   12....       LCALL   ??ZDO_ParseEPListRsp?relay; Banked call to: ZDO_ParseEPListRsp
   \   000090   8A..         MOV     ?V0,R2
   \   000092   8B..         MOV     ?V1,R3
   \   000094   EA           MOV     A,R2
   \   000095   45..         ORL     A,?V1
   \   000097   60B2         JZ      ??ParkWay_ProcessEvent_4
   \   000099   8A82         MOV     DPL,R2
   \   00009B   8B83         MOV     DPH,R3
   \   00009D   E0           MOVX    A,@DPTR
   \   00009E   7037         JNZ     ??ParkWay_ProcessEvent_7
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   6031         JZ      ??ParkWay_ProcessEvent_7
   \   0000A6   90....       MOV     DPTR,#ParkWay_DstAddr + 8
   \   0000A9   7402         MOV     A,#0x2
   \   0000AB   F0           MOVX    @DPTR,A
   \   0000AC   8A82         MOV     DPL,R2
   \   0000AE   8B83         MOV     DPH,R3
   \   0000B0   A3           INC     DPTR
   \   0000B1   E0           MOVX    A,@DPTR
   \   0000B2   F8           MOV     R0,A
   \   0000B3   A3           INC     DPTR
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   F9           MOV     R1,A
   \   0000B6   90....       MOV     DPTR,#ParkWay_DstAddr
   \   0000B9   E8           MOV     A,R0
   \   0000BA   F0           MOVX    @DPTR,A
   \   0000BB   A3           INC     DPTR
   \   0000BC   E9           MOV     A,R1
   \   0000BD   F0           MOVX    @DPTR,A
   \   0000BE   8A82         MOV     DPL,R2
   \   0000C0   8B83         MOV     DPH,R3
   \   0000C2   A3           INC     DPTR
   \   0000C3   A3           INC     DPTR
   \   0000C4   A3           INC     DPTR
   \   0000C5   A3           INC     DPTR
   \   0000C6   E0           MOVX    A,@DPTR
   \   0000C7   90....       MOV     DPTR,#ParkWay_DstAddr + 9
   \   0000CA   F0           MOVX    @DPTR,A
   \   0000CB                ; Setup parameters for call to function osal_stop_timerEx
   \   0000CB   7A02         MOV     R2,#0x2
   \   0000CD   7B00         MOV     R3,#0x0
   \   0000CF   90....       MOV     DPTR,#ParkWay_TaskID
   \   0000D2   E0           MOVX    A,@DPTR
   \   0000D3   F9           MOV     R1,A
   \   0000D4   12....       LCALL   ??osal_stop_timerEx?relay; Banked call to: osal_stop_timerEx
   \                     ??ParkWay_ProcessEvent_7:
   \   0000D7                ; Setup parameters for call to function osal_mem_free
   \   0000D7   AA..         MOV     R2,?V0
   \   0000D9   AB..         MOV     R3,?V1
   \   0000DB   12....       LCALL   ??osal_mem_free?relay; Banked call to: osal_mem_free
   \   0000DE   02....       LJMP    ??ParkWay_ProcessEvent_4 & 0xFFFF
    252              }
    253          
    254              // return unprocessed events
    255              return (events ^ SYS_EVENT_MSG);
   \                     ??ParkWay_ProcessEvent_5:
   \   0000E1   EE           MOV     A,R6
   \   0000E2   FA           MOV     R2,A
   \   0000E3   EF           MOV     A,R7
   \   0000E4   6480         XRL     A,#0x80
   \   0000E6   02....       LJMP    ??ParkWay_ProcessEvent_8 & 0xFFFF
    256            }
    257          
    258            // Send to the coordinator the status of ultrasound
    259            if ( events & ParkWay_SEND_MSG_EVT )
   \                     ??ParkWay_ProcessEvent_0:
   \   0000E9   EE           MOV     A,R6
   \   0000EA   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000EC   4003         JC      $+5
   \   0000EE   02....       LJMP    ??ParkWay_ProcessEvent_9 & 0xFFFF
    260            {
    261              // Send "the" message
    262              ParkWay_SendTheMessage();
   \   0000F1   85..82       MOV     DPL,?XSP + 0
   \   0000F4   85..83       MOV     DPH,?XSP + 1
   \   0000F7   7445         MOV     A,#0x45
   \   0000F9   F0           MOVX    @DPTR,A
   \   0000FA   7401         MOV     A,#0x1
   \   0000FC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FF   7444         MOV     A,#0x44
   \   000101   F0           MOVX    @DPTR,A
   \   000102   7402         MOV     A,#0x2
   \   000104   12....       LCALL   ?XSTACK_DISP0_8
   \   000107   7430         MOV     A,#0x30
   \   000109   F0           MOVX    @DPTR,A
   \   00010A   7403         MOV     A,#0x3
   \   00010C   12....       LCALL   ?XSTACK_DISP0_8
   \   00010F   7436         MOV     A,#0x36
   \   000111   F0           MOVX    @DPTR,A
   \   000112   7404         MOV     A,#0x4
   \   000114   12....       LCALL   ?XSTACK_DISP0_8
   \   000117   742D         MOV     A,#0x2d
   \   000119   F0           MOVX    @DPTR,A
   \   00011A   90....       MOV     DPTR,#vaga
   \   00011D   E0           MOVX    A,@DPTR
   \   00011E   C0E0         PUSH    A
   \   000120   7405         MOV     A,#0x5
   \   000122   12....       LCALL   ?XSTACK_DISP0_8
   \   000125   D0E0         POP     A
   \   000127   F0           MOVX    @DPTR,A
   \   000128                ; Setup parameters for call to function AF_DataRequest
   \   000128   75..1E       MOV     ?V0,#0x1e
   \   00012B   78..         MOV     R0,#?V0
   \   00012D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000130   75....       MOV     ?V0,#ParkWay_TransID & 0xff
   \   000133   75....       MOV     ?V1,#(ParkWay_TransID >> 8) & 0xff
   \   000136   78..         MOV     R0,#?V0
   \   000138   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00013B   7403         MOV     A,#0x3
   \   00013D   12....       LCALL   ?XSTACK_DISP100_8
   \   000140   88..         MOV     ?V0,R0
   \   000142   89..         MOV     ?V1,R1
   \   000144   78..         MOV     R0,#?V0
   \   000146   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000149                ; Setup parameters for call to function osal_strlen
   \   000149   7405         MOV     A,#0x5
   \   00014B   12....       LCALL   ?XSTACK_DISP101_8
   \   00014E   12....       LCALL   ??osal_strlen?relay  ; Banked call to: osal_strlen
   \   000151   EA           MOV     A,R2
   \   000152   2401         ADD     A,#0x1
   \   000154   F5..         MOV     ?V0,A
   \   000156   E4           CLR     A
   \   000157   3400         ADDC    A,#0x0
   \   000159   F5..         MOV     ?V1,A
   \   00015B   78..         MOV     R0,#?V0
   \   00015D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000160   75..01       MOV     ?V0,#0x1
   \   000163   75..00       MOV     ?V1,#0x0
   \   000166   78..         MOV     R0,#?V0
   \   000168   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00016B   7920         MOV     R1,#0x20
   \   00016D   7C..         MOV     R4,#ParkWay_epDesc & 0xff
   \   00016F   7D..         MOV     R5,#(ParkWay_epDesc >> 8) & 0xff
   \   000171   7A..         MOV     R2,#ParkWay_DstAddr & 0xff
   \   000173   7B..         MOV     R3,#(ParkWay_DstAddr >> 8) & 0xff
   \   000175   12....       LCALL   ??AF_DataRequest?relay; Banked call to: AF_DataRequest
   \   000178   7409         MOV     A,#0x9
   \   00017A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00017D   E9           MOV     A,R1
   \   00017E   601C         JZ      ??ParkWay_ProcessEvent_10
   \   000180                ; Setup parameters for call to function osal_stop_timerEx
   \   000180   7A01         MOV     R2,#0x1
   \   000182   7B00         MOV     R3,#0x0
   \   000184   90....       MOV     DPTR,#ParkWay_TaskID
   \   000187   E0           MOVX    A,@DPTR
   \   000188   F9           MOV     R1,A
   \   000189   12....       LCALL   ??osal_stop_timerEx?relay; Banked call to: osal_stop_timerEx
   \   00018C                ; Setup parameters for call to function osal_start_timerEx
   \   00018C   7CC8         MOV     R4,#-0x38
   \   00018E   7D00         MOV     R5,#0x0
   \   000190   7A02         MOV     R2,#0x2
   \   000192   7B00         MOV     R3,#0x0
   \   000194   90....       MOV     DPTR,#ParkWay_TaskID
   \   000197   E0           MOVX    A,@DPTR
   \   000198   F9           MOV     R1,A
   \   000199   12....       LCALL   ??osal_start_timerEx?relay; Banked call to: osal_start_timerEx
    263              
    264              // Setup to send message again
    265              osal_start_timerEx( ParkWay_TaskID,
    266                                  ParkWay_SEND_MSG_EVT,
    267                                  ParkWay_SEND_MSG_TIMEOUT );
   \                     ??ParkWay_ProcessEvent_10:
   \   00019C                ; Setup parameters for call to function osal_start_timerEx
   \   00019C   7C20         MOV     R4,#0x20
   \   00019E   7D03         MOV     R5,#0x3
   \   0001A0   7A01         MOV     R2,#0x1
   \   0001A2   7B00         MOV     R3,#0x0
   \   0001A4   90....       MOV     DPTR,#ParkWay_TaskID
   \   0001A7   E0           MOVX    A,@DPTR
   \   0001A8   F9           MOV     R1,A
   \   0001A9   12....       LCALL   ??osal_start_timerEx?relay; Banked call to: osal_start_timerEx
    268          
    269              // return unprocessed events
    270              return (events ^ ParkWay_SEND_MSG_EVT);
   \   0001AC   EE           MOV     A,R6
   \   0001AD   6401         XRL     A,#0x1
   \   0001AF   FA           MOV     R2,A
   \   0001B0   EF           MOV     A,R7
   \                     ??ParkWay_ProcessEvent_8:
   \   0001B1   FB           MOV     R3,A
   \   0001B2   02....       LJMP    ??ParkWay_ProcessEvent_11 & 0xFFFF
    271            }
    272            
    273            if(events & POLLING_ULTRASONIC)
   \                     ??ParkWay_ProcessEvent_9:
   \   0001B5   5404         ANL     A,#0x4
   \   0001B7   6013         JZ      ??ParkWay_ProcessEvent_12
    274            {
    275              osal_start_timerEx( ParkWay_TaskID,
    276                                  POLLING_ULTRASONIC,
    277                                  TIME_ULTRA);
   \   0001B9                ; Setup parameters for call to function osal_start_timerEx
   \   0001B9   7CC8         MOV     R4,#-0x38
   \   0001BB   7D00         MOV     R5,#0x0
   \   0001BD   7A04         MOV     R2,#0x4
   \   0001BF   7B00         MOV     R3,#0x0
   \   0001C1   90....       MOV     DPTR,#ParkWay_TaskID
   \   0001C4   E0           MOVX    A,@DPTR
   \   0001C5   F9           MOV     R1,A
   \   0001C6   12....       LCALL   ??osal_start_timerEx?relay; Banked call to: osal_start_timerEx
    278              read_ultrasonic();
   \   0001C9                ; Setup parameters for call to function read_ultrasonic
   \   0001C9   12....       LCALL   ??read_ultrasonic?relay; Banked call to: read_ultrasonic
    279            }
    280            
    281            if(events & POLLING_OF_DEV_EVT) //This force the auto bind to the coordinator or Router
   \                     ??ParkWay_ProcessEvent_12:
   \   0001CC   EE           MOV     A,R6
   \   0001CD   5402         ANL     A,#0x2
   \   0001CF   6060         JZ      ??ParkWay_ProcessEvent_13
    282            {
    283              //HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON);
    284              // Initiate a Match Description Request (Service Discovery)
    285              dstAddr.addrMode = AddrBroadcast;
   \   0001D1   740E         MOV     A,#0xe
   \   0001D3   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D6   740F         MOV     A,#0xf
   \   0001D8   F0           MOVX    @DPTR,A
    286              dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \   0001D9   7406         MOV     A,#0x6
   \   0001DB   12....       LCALL   ?XSTACK_DISP0_8
   \   0001DE   74FF         MOV     A,#-0x1
   \   0001E0   F0           MOVX    @DPTR,A
   \   0001E1   A3           INC     DPTR
   \   0001E2   F0           MOVX    @DPTR,A
    287              ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    288                                ParkWay_PROFID,
    289                                ParkWay_MAX_CLUSTERS, (cId_t *)ParkWay_ClusterList,
    290                                ParkWay_MAX_CLUSTERS, (cId_t *)ParkWay_ClusterList,
    291                                FALSE );
   \   0001E3   75....       MOV     ?V0,#ParkWay_ClusterList & 0xff
   \   0001E6   75....       MOV     ?V1,#(ParkWay_ClusterList >> 8) & 0xff
   \   0001E9                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0001E9   75..00       MOV     ?V2,#0x0
   \   0001EC   78..         MOV     R0,#?V2
   \   0001EE   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001F1   78..         MOV     R0,#?V0
   \   0001F3   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001F6   75..01       MOV     ?V2,#0x1
   \   0001F9   78..         MOV     R0,#?V2
   \   0001FB   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001FE   78..         MOV     R0,#?V0
   \   000200   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000203   75..04       MOV     ?V0,#0x4
   \   000206   75..0F       MOV     ?V1,#0xf
   \   000209   78..         MOV     R0,#?V0
   \   00020B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00020E   7901         MOV     R1,#0x1
   \   000210   7CFF         MOV     R4,#-0x1
   \   000212   7DFF         MOV     R5,#-0x1
   \   000214   740E         MOV     A,#0xe
   \   000216   12....       LCALL   ?XSTACK_DISP101_8
   \   000219   12....       LCALL   ??ZDP_MatchDescReq?relay; Banked call to: ZDP_MatchDescReq
   \   00021C   7408         MOV     A,#0x8
   \   00021E   12....       LCALL   ?DEALLOC_XSTACK8
    292              osal_start_timerEx( ParkWay_TaskID,
    293                                  POLLING_OF_DEV_EVT,
    294                                  TIME_TO_CONNECT_COORD);
   \   000221                ; Setup parameters for call to function osal_start_timerEx
   \   000221   7CE8         MOV     R4,#-0x18
   \   000223   7D03         MOV     R5,#0x3
   \   000225   7A02         MOV     R2,#0x2
   \   000227   7B00         MOV     R3,#0x0
   \   000229   90....       MOV     DPTR,#ParkWay_TaskID
   \   00022C   E0           MOVX    A,@DPTR
   \   00022D   F9           MOV     R1,A
   \   00022E   12....       LCALL   ??osal_start_timerEx?relay; Banked call to: osal_start_timerEx
    295            } 
    296          
    297          
    298            HalLedSet( HAL_LED_ALL, HAL_LED_MODE_OFF ); //Shutdown all LEDS to reduce consumption of power
   \                     ??ParkWay_ProcessEvent_13:
   \   000231                ; Setup parameters for call to function HalLedSet
   \   000231   7A00         MOV     R2,#0x0
   \   000233   790F         MOV     R1,#0xf
   \   000235   12....       LCALL   ??HalLedSet?relay    ; Banked call to: HalLedSet
    299            
    300            // Discard unknown events
    301            return 0;
   \   000238   7A00         MOV     R2,#0x0
   \   00023A   7B00         MOV     R3,#0x0
   \                     ??ParkWay_ProcessEvent_11:
   \   00023C   740F         MOV     A,#0xf
   \   00023E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000241   7F06         MOV     R7,#0x6
   \   000243   02....       LJMP    ?BANKED_LEAVE_XDATA
    302          }
    303          
    304          /*********************************************************************
    305           * Event Generation Functions
    306           */
    307          
    308          /*********************************************************************
    309           */
    310          //This function process the ZDO events to bind
    311          static void ParkWay_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    312          {
    313            switch ( inMsg->clusterID )
    314            {
    315              case End_Device_Bind_rsp:
    316                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    317                {
    318                  // Light LED
    319                  //HalLedSet ( HAL_LED_2, HAL_LED_MODE_FLASH );
    320                }
    321                break;
    322          
    323              case Match_Desc_rsp:
    324                {
    325                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
    326                  if ( pRsp )
    327                  {
    328                    if ( pRsp->status == ZSuccess && pRsp->cnt )
    329                    {
    330                      ParkWay_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
    331                      ParkWay_DstAddr.addr.shortAddr = pRsp->nwkAddr;
    332                      // Take the first endpoint, Can be changed to search through endpoints
    333                      ParkWay_DstAddr.endPoint = pRsp->epList[0];
    334          
    335                      // Light LED
    336                      //HalLedSet( HAL_LED_2, HAL_LED_MODE_ON );
    337          
    338                      //This stop the peer from send request do the coordinator
    339                      //HalLedSet ( HAL_LED_1, HAL_LED_MODE_OFF);
    340                      osal_stop_timerEx( ParkWay_TaskID,POLLING_OF_DEV_EVT);
    341                    }
    342                    osal_mem_free( pRsp );
    343                  }
    344                }
    345                break;
    346            }
    347          }
    348          
    349          /*********************************************************************
    350           * LOCAL FUNCTIONS
    351           */
    352          //This function process the frames received by the application framework (source routers or the coordinator)
    353          
    354          static void ParkWay_MessageMSGCB( afIncomingMSGPacket_t *pkt_1 )
    355          {
    356            /************************************************* This was used to send some specific data do the last device connected to the COORDINATOR (HDA)**************************************/
    357            // uint8* pkt;
    358            // pkt=(pkt_1->cmd.Data);
    359            
    360            // uint8 pin_ultra=4;
    361            
    362            // P0SEL &= (~BV(2));
    363            // P0DIR |= (BV(2));
    364              
    365            // if(*pkt==48||*(pkt+1)==48||*(pkt+2)==48)
    366            // {
    367            //  P0&=~pin_ultra;
    368            // }
    369            // else
    370            // {
    371            //   P0|=pin_ultra;
    372            // }
    373            /************************************************* This was used to send some specific data do the last device connected to the COORDINATOR (HDA)**************************************/
    374          }
    375          
    376          //This function send the status of own park to the coordinator
    377          static void ParkWay_SendTheMessage( void )
    378          {
    379            uint8 pData[6];
    380            pData[0] = 'E';
    381            pData[1] = 'D';
    382            pData[2] = DEVICE_PW_1;
    383            pData[3] = DEVICE_PW_2;
    384            pData[4] = '-';
    385            pData[5] = vaga;
    386          
    387            //Send data to the coordinator ADDRESS(0000)
    388            if ( AF_DataRequest( &ParkWay_DstAddr, &ParkWay_epDesc,
    389                                 ParkWay_CLUSTERID,
    390                                 (byte)osal_strlen( pData ) + 1,
                                                           ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char *"
    391                                 (byte *)&pData,
    392                                 &ParkWay_TransID,
    393                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    394            {
    395              // Successfully requested to be sent.
    396            }
    397            else
    398            {
    399              osal_stop_timerEx( ParkWay_TaskID,
    400                                  ParkWay_SEND_MSG_EVT);
    401              osal_start_timerEx( ParkWay_TaskID,
    402                                  POLLING_OF_DEV_EVT,
    403                                  200);
    404            }
    405          }
    406          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    407          static void UART_CallBack(uint8 port, uint8 event)
   \                     UART_CallBack:
    408          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FF           MOV     R7,A
    409            (void)port;
    410            uint8 cmdbuff[1];
    411            if (event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT))
   \   00000C   7407         MOV     A,#0x7
   \   00000E   5F           ANL     A,R7
   \   00000F   6014         JZ      ??UART_CallBack_0
    412            {
    413              HalUARTRead(port, cmdbuff, 1);
   \   000011                ; Setup parameters for call to function HalUARTRead
   \   000011   7C01         MOV     R4,#0x1
   \   000013   7D00         MOV     R5,#0x0
   \   000015   AA..         MOV     R2,?XSP + 0
   \   000017   AB..         MOV     R3,?XSP + 1
   \   000019   12....       LCALL   ??HalUARTRead?relay  ; Banked call to: HalUARTRead
    414              SendUART(cmdbuff,1);
   \   00001C                ; Setup parameters for call to function SendUART
   \   00001C   7901         MOV     R1,#0x1
   \   00001E   AA..         MOV     R2,?XSP + 0
   \   000020   AB..         MOV     R3,?XSP + 1
   \   000022   12....       LCALL   ??SendUART?relay     ; Banked call to: SendUART
    415            }
    416          }
   \                     ??UART_CallBack_0:
   \   000025   7401         MOV     A,#0x1
   \   000027   12....       LCALL   ?DEALLOC_XSTACK8
   \   00002A   02....       LJMP    ?Subroutine0 & 0xFFFF
    417          
    418          //This function initializes the UART

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    419          void uart_init()
   \                     uart_init:
    420          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 29
   \   000004   74E3         MOV     A,#-0x1d
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    421            halUARTCfg_t uartConfig;
    422            uartConfig.configured = TRUE; // 2x30 don't care - see uart driver.
   \   000009   85..82       MOV     DPL,?XSP + 0
   \   00000C   85..83       MOV     DPH,?XSP + 1
   \   00000F   7401         MOV     A,#0x1
   \   000011   F0           MOVX    @DPTR,A
    423            uartConfig.baudRate = HAL_UART_BR_9600;
   \   000012   12....       LCALL   ?XSTACK_DISP0_8
   \   000015   E4           CLR     A
   \   000016   F0           MOVX    @DPTR,A
    424            uartConfig.flowControl = TRUE;
   \   000017   7402         MOV     A,#0x2
   \   000019   12....       LCALL   ?XSTACK_DISP0_8
   \   00001C   7401         MOV     A,#0x1
   \   00001E   F0           MOVX    @DPTR,A
    425            uartConfig.flowControlThreshold = 48; // 2x30 don't care - see uart driver.
   \   00001F   7403         MOV     A,#0x3
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7430         MOV     A,#0x30
   \   000026   F0           MOVX    @DPTR,A
   \   000027   A3           INC     DPTR
   \   000028   E4           CLR     A
   \   000029   F0           MOVX    @DPTR,A
    426            uartConfig.rx.maxBufSize = 128; // 2x30 don't care - see uart driver.
   \   00002A   740A         MOV     A,#0xa
   \   00002C   12....       LCALL   ?XSTACK_DISP0_8
   \   00002F   7480         MOV     A,#-0x80
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   E4           CLR     A
   \   000034   F0           MOVX    @DPTR,A
    427            uartConfig.tx.maxBufSize = 128; // 2x30 don't care - see uart driver.
   \   000035   7412         MOV     A,#0x12
   \   000037   12....       LCALL   ?XSTACK_DISP0_8
   \   00003A   7480         MOV     A,#-0x80
   \   00003C   F0           MOVX    @DPTR,A
   \   00003D   A3           INC     DPTR
   \   00003E   E4           CLR     A
   \   00003F   F0           MOVX    @DPTR,A
    428            uartConfig.idleTimeout = 6; // 2x30 don't care - see uart driver.
   \   000040   7405         MOV     A,#0x5
   \   000042   12....       LCALL   ?XSTACK_DISP0_8
   \   000045   7406         MOV     A,#0x6
   \   000047   F0           MOVX    @DPTR,A
    429            uartConfig.intEnable = TRUE; // 2x30 don't care - see uart driver.
   \   000048   7416         MOV     A,#0x16
   \   00004A   12....       LCALL   ?XSTACK_DISP0_8
   \   00004D   7401         MOV     A,#0x1
   \   00004F   F0           MOVX    @DPTR,A
    430            uartConfig.callBackFunc = UART_CallBack;
   \   000050   741B         MOV     A,#0x1b
   \   000052   12....       LCALL   ?XSTACK_DISP0_8
   \   000055   74..         MOV     A,#??UART_CallBack?relay & 0xff
   \   000057   F0           MOVX    @DPTR,A
   \   000058   A3           INC     DPTR
   \   000059   74..         MOV     A,#(??UART_CallBack?relay >> 8) & 0xff
   \   00005B   F0           MOVX    @DPTR,A
    431            HalUARTOpen (HAL_UART_PORT_0, &uartConfig);
   \   00005C                ; Setup parameters for call to function HalUARTOpen
   \   00005C   AA..         MOV     R2,?XSP + 0
   \   00005E   AB..         MOV     R3,?XSP + 1
   \   000060   7900         MOV     R1,#0x0
   \   000062   12....       LCALL   ??HalUARTOpen?relay  ; Banked call to: HalUARTOpen
    432          }
   \   000065   741D         MOV     A,#0x1d
   \   000067   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006A   D083         POP     DPH
   \   00006C   D082         POP     DPL
   \   00006E   02....       LJMP    ?BRET
    433          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    434          void control_fifo(uint16 ultra)
   \                     control_fifo:
    435          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    436          
    437            uint8 i,empty=0,full=0;
   \   000005   7D00         MOV     R5,#0x0
   \   000007   7C00         MOV     R4,#0x0
    438            
    439            if(ultra>DISTANCE_CONSTANT)
   \   000009   C3           CLR     C
   \   00000A   EA           MOV     A,R2
   \   00000B   9411         SUBB    A,#0x11
   \   00000D   EB           MOV     A,R3
   \   00000E   9427         SUBB    A,#0x27
   \   000010   90....       MOV     DPTR,#index_flag
   \   000013   E0           MOVX    A,@DPTR
   \   000014   F8           MOV     R0,A
   \   000015   74..         MOV     A,#fifo_ultra & 0xff
   \   000017   4007         JC      ??control_fifo_0
    440            {
    441              fifo_ultra[index_flag]='0';
   \   000019   12....       LCALL   ?Subroutine2 & 0xFFFF
    442            }
   \                     ??CrossCallReturnLabel_0:
   \   00001C   7430         MOV     A,#0x30
   \   00001E   8005         SJMP    ??control_fifo_1
    443            else
    444            {
    445              fifo_ultra[index_flag]='1';
   \                     ??control_fifo_0:
   \   000020   12....       LCALL   ?Subroutine2 & 0xFFFF
    446            }
   \                     ??CrossCallReturnLabel_1:
   \   000023   7431         MOV     A,#0x31
   \                     ??control_fifo_1:
   \   000025   F0           MOVX    @DPTR,A
    447          
    448            if(index_flag==11)
   \   000026   90....       MOV     DPTR,#index_flag
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   640B         XRL     A,#0xb
   \   00002C   7047         JNZ     ??control_fifo_2
    449            {
    450              for(i=0;i<12;i++)
   \   00002E   7800         MOV     R0,#0x0
    451              {
    452                if(fifo_ultra[i]=='1')  full++;
   \                     ??control_fifo_3:
   \   000030   74..         MOV     A,#fifo_ultra & 0xff
   \   000032   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000035   E0           MOVX    A,@DPTR
   \   000036   6431         XRL     A,#0x31
   \   000038   7003         JNZ     ??control_fifo_4
   \   00003A   0C           INC     R4
   \   00003B   8006         SJMP    ??control_fifo_5
    453                else if (fifo_ultra[i]=='0')  empty++;
   \                     ??control_fifo_4:
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   6430         XRL     A,#0x30
   \   000040   7001         JNZ     ??control_fifo_5
   \   000042   0D           INC     R5
    454              }
   \                     ??control_fifo_5:
   \   000043   08           INC     R0
   \   000044   E8           MOV     A,R0
   \   000045   C3           CLR     C
   \   000046   940C         SUBB    A,#0xc
   \   000048   40E6         JC      ??control_fifo_3
    455            }
    456          
    457            if(empty!=full)
   \   00004A   EC           MOV     A,R4
   \   00004B   6D           XRL     A,R5
   \   00004C   6027         JZ      ??control_fifo_2
    458            { 
    459              if(empty>full)  vaga='0';
   \   00004E   EC           MOV     A,R4
   \   00004F   C3           CLR     C
   \   000050   9D           SUBB    A,R5
   \   000051   90....       MOV     DPTR,#vaga
   \   000054   501A         JNC     ??control_fifo_6
   \   000056   7430         MOV     A,#0x30
   \   000058   F0           MOVX    @DPTR,A
    460              else  vaga='1';
    461            }
    462            
    463            if(vaga=='1')
    464            {
    465              P0 &= ~PIN_RED_LED; 
    466              Onboard_wait(1); 
    467              P0 |= PIN_GREEN_LED;
    468            }
    469            else
    470            {
    471              P0 &= ~PIN_GREEN_LED; 
   \                     ??control_fifo_7:
   \   000059   C283         CLR     0x80.3
    472              Onboard_wait(1); 
   \   00005B                ; Setup parameters for call to function Onboard_wait
   \   00005B   7A01         MOV     R2,#0x1
   \   00005D   7B00         MOV     R3,#0x0
   \   00005F   12....       LCALL   ??Onboard_wait?relay ; Banked call to: Onboard_wait
    473              P0 |= PIN_RED_LED;
   \   000062   D284         SETB    0x80.4
    474            }
    475          
    476            if(index_flag>=12) 
   \                     ??control_fifo_8:
   \   000064   90....       MOV     DPTR,#index_flag
   \   000067   E0           MOVX    A,@DPTR
   \   000068   C3           CLR     C
   \   000069   940C         SUBB    A,#0xc
   \   00006B   401D         JC      ??control_fifo_9
    477              index_flag = 0;
   \   00006D   E4           CLR     A
   \   00006E   801C         SJMP    ??control_fifo_10
   \                     ??control_fifo_6:
   \   000070   7431         MOV     A,#0x31
   \   000072   F0           MOVX    @DPTR,A
   \   000073   8008         SJMP    ??control_fifo_11
   \                     ??control_fifo_2:
   \   000075   90....       MOV     DPTR,#vaga
   \   000078   E0           MOVX    A,@DPTR
   \   000079   6431         XRL     A,#0x31
   \   00007B   70DC         JNZ     ??control_fifo_7
   \                     ??control_fifo_11:
   \   00007D   C284         CLR     0x80.4
   \   00007F                ; Setup parameters for call to function Onboard_wait
   \   00007F   7A01         MOV     R2,#0x1
   \   000081   7B00         MOV     R3,#0x0
   \   000083   12....       LCALL   ??Onboard_wait?relay ; Banked call to: Onboard_wait
   \   000086   D283         SETB    0x80.3
   \   000088   80DA         SJMP    ??control_fifo_8
    478            else
    479              index_flag++;
   \                     ??control_fifo_9:
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   04           INC     A
   \                     ??control_fifo_10:
   \   00008C   F0           MOVX    @DPTR,A
    480          
    481          }
   \   00008D                REQUIRE ?Subroutine1
   \   00008D                REQUIRE _A_P0
   \   00008D                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   28           ADD     A,R0
   \   000001   F582         MOV     DPL,A
   \   000003   E4           CLR     A
   \   000004   34..         ADDC    A,#(fifo_ultra >> 8) & 0xff
   \   000006   F583         MOV     DPH,A
   \   000008   22           RET
    482          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    483          void read_ultrasonic()
   \                     read_ultrasonic:
    484          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    485              uint16 i;
    486          
    487              P0SEL &= ~(PIN_GREEN_LED+PIN_RED_LED);
   \   000005   53F3E7       ANL     0xf3,#0xe7
    488              P0DIR |= PIN_GREEN_LED+PIN_RED_LED;
   \   000008   43FD18       ORL     0xfd,#0x18
    489              
    490              //Configure trigger
    491              P0SEL &= ~PIN_TRIGGER;   //P0_1 GPIO
   \   00000B   53F3FD       ANL     0xf3,#0xfd
    492              P0DIR |= PIN_TRIGGER;    //P0_1 output
   \   00000E   43FD02       ORL     0xfd,#0x2
    493              //Onboard_wait(10);
    494              P0SEL &= ~PIN_ECHO;   //P0_2 GPIO
   \   000011   53F3FB       ANL     0xf3,#0xfb
    495              P0DIR &= ~PIN_ECHO;   //P0_2 input
   \   000014   53FDFB       ANL     0xfd,#0xfb
    496              Onboard_wait(1);
   \   000017                ; Setup parameters for call to function Onboard_wait
   \   000017   7A01         MOV     R2,#0x1
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??Onboard_wait?relay ; Banked call to: Onboard_wait
    497          
    498              P0 &= ~PIN_TRIGGER;       //------> 0
   \   00001E   C281         CLR     0x80.1
    499              Onboard_wait(6);
   \   000020                ; Setup parameters for call to function Onboard_wait
   \   000020   7A06         MOV     R2,#0x6
   \   000022   7B00         MOV     R3,#0x0
   \   000024   12....       LCALL   ??Onboard_wait?relay ; Banked call to: Onboard_wait
    500              P0 |= PIN_TRIGGER;        //------> 1
   \   000027   D281         SETB    0x80.1
    501              Onboard_wait(6);      //------> 6us
   \   000029                ; Setup parameters for call to function Onboard_wait
   \   000029   7A06         MOV     R2,#0x6
   \   00002B   7B00         MOV     R3,#0x0
   \   00002D   12....       LCALL   ??Onboard_wait?relay ; Banked call to: Onboard_wait
    502              P0 &= ~PIN_TRIGGER;       //------> 0 
   \   000030   C281         CLR     0x80.1
    503              Onboard_wait(6); 
   \   000032                ; Setup parameters for call to function Onboard_wait
   \   000032   7A06         MOV     R2,#0x6
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??Onboard_wait?relay ; Banked call to: Onboard_wait
    504          
    505              while((!(P0&PIN_ECHO)))/*||(timeout_1<65530)) timeout_1++*/;
   \                     ??read_ultrasonic_0:
   \   000039   A282         MOV     C,0x80.2
   \   00003B   50FC         JNC     ??read_ultrasonic_0
    506              while(P0&PIN_ECHO)
   \                     ??read_ultrasonic_1:
   \   00003D   A282         MOV     C,0x80.2
   \   00003F   5010         JNC     ??read_ultrasonic_2
    507              {
    508                if(i<65530) 
   \   000041   C3           CLR     C
   \   000042   EE           MOV     A,R6
   \   000043   94FA         SUBB    A,#-0x6
   \   000045   EF           MOV     A,R7
   \   000046   94FF         SUBB    A,#-0x1
   \   000048   5007         JNC     ??read_ultrasonic_2
    509                  i++; 
   \   00004A   0E           INC     R6
   \   00004B   EE           MOV     A,R6
   \   00004C   70EF         JNZ     ??read_ultrasonic_1
   \   00004E   0F           INC     R7
   \   00004F   80EC         SJMP    ??read_ultrasonic_1
    510                else 
    511                  break;
    512              }
    513                  
    514              control_fifo(i);
   \                     ??read_ultrasonic_2:
   \   000051                ; Setup parameters for call to function control_fifo
   \   000051   EE           MOV     A,R6
   \   000052   FA           MOV     R2,A
   \   000053   EF           MOV     A,R7
   \   000054   FB           MOV     R3,A
   \   000055   12....       LCALL   ??control_fifo?relay ; Banked call to: control_fifo
    515          
    516          
    517              #ifdef DEBUG_ULTRA
    518                char dist[5];
    519                dist[0] = (i/10000) + 0x30;
    520                dist[1] = (i%10000)/1000 + 0x30;
    521                dist[2] = (((i%10000)%1000)/100) + 0x30;
    522                dist[3] = ((((i%10000)%1000)%100)/10) +0x30; 
    523                dist[4] = ((((i%10000)%1000)%100)%10) + 0x30;
    524              #endif
    525          }
   \   000058   02....       LJMP    ?Subroutine0 & 0xFFFF
   \   00005B                REQUIRE P0SEL
   \   00005B                REQUIRE P0DIR
   \   00005B                REQUIRE _A_P0
    526          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    527          void SendUART(uint8 *data,uint8 len)
   \                     SendUART:
    528          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    529            HalUARTWrite(HAL_UART_PORT_0, data, len);
   \   000006                ; Setup parameters for call to function HalUARTWrite
   \   000006   FC           MOV     R4,A
   \   000007   7D00         MOV     R5,#0x0
   \   000009   7900         MOV     R1,#0x0
   \   00000B   12....       LCALL   ??HalUARTWrite?relay ; Banked call to: HalUARTWrite
    530          }
   \   00000E   80..         SJMP    ?Subroutine1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for vaga>`:
   \   000000   30           DB 48

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for fifo_ultra>`:
   \   000000   30303030     DB 30H, 30H, 30H, 30H, 30H, 30H, 30H, 30H
   \            30303030
   \   000008   30303030     DB 30H, 30H, 30H, 30H

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ParkWay_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ParkWay_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ParkWay_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ParkWay_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??UART_CallBack?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    UART_CallBack

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??uart_init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    uart_init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??control_fifo?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    control_fifo

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??read_ultrasonic?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    read_ultrasonic

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SendUART?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SendUART
    531          
    532          
    533          /*********************************************************************/

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      0      9   ParkWay_Init
        0      9   -> RegisterForKeys
        0      9   -> ZDO_RegisterForZDOMsg
        0      9   -> afRegister
        0      9   -> osal_start_timerEx
      1     38   ParkWay_ProcessEvent
        0     38   -> AF_DataRequest
        0     29   -> HalLedSet
        0     29   -> ZDO_ParseEPListRsp
        0     37   -> ZDP_MatchDescReq
        0     29   -> osal_mem_free
        0     29   -> osal_msg_deallocate
        0     29   -> osal_msg_receive
        0     29   -> osal_start_timerEx
        0     29   -> osal_stop_timerEx
        0     34   -> osal_strlen
        0     29   -> read_ultrasonic
      0     20   SendUART
        0     10   -> HalUARTWrite
      0     10   UART_CallBack
        0     10   -> HalUARTRead
        0     10   -> SendUART
      0     19   control_fifo
        0     10   -> Onboard_wait
      0     38   read_ultrasonic
        0      9   -> Onboard_wait
        0      9   -> control_fifo
      2     29   uart_init
        2     29   -> HalUARTOpen


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      12  ?<Initializer for fifo_ultra>
       1  ?<Initializer for vaga>
       6  ??ParkWay_Init?relay
       6  ??ParkWay_ProcessEvent?relay
       6  ??SendUART?relay
       6  ??UART_CallBack?relay
       6  ??control_fifo?relay
       6  ??read_ultrasonic?relay
       6  ??uart_init?relay
       5  ?Subroutine0
       5  ?Subroutine1
       9  ?Subroutine2
       1  P0DIR
       1  P0SEL
       2  ParkWay_ClusterList
      12  ParkWay_DstAddr
     113  ParkWay_Init
       1  ParkWay_NwkState
     582  ParkWay_ProcessEvent
      12  ParkWay_SimpleDesc
       1  ParkWay_TaskID
       1  ParkWay_TransID
       6  ParkWay_epDesc
      16  SendUART
      45  UART_CallBack
       1  _A_P0
     141  control_fifo
      12  fifo_ultra
       1  index_flag
      91  read_ultrasonic
     113  uart_init
       1  vaga

 
 1 120 bytes in segment BANKED_CODE
    42 bytes in segment BANK_RELAYS
     3 bytes in segment SFR_AN
    13 bytes in segment XDATA_I
    13 bytes in segment XDATA_ID
    14 bytes in segment XDATA_ROM_C
    22 bytes in segment XDATA_Z
 
 1 175 bytes of CODE  memory
    14 bytes of CONST memory
     0 bytes of DATA  memory (+ 3 bytes shared)
    35 bytes of XDATA memory

Errors: none
Warnings: 1
